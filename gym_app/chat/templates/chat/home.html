{% extends "base.html" %}

{% block title %}Chat con IA{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="text-center mb-4">
        <h1 class="display-5">Chat con IA</h1>
        <p class="lead">Haz preguntas, conversa o simplemente prueba la inteligencia artificial.</p>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <!-- Mensajes del chat -->
            <div id="chat-messages" class="border rounded p-3 mb-3 bg-light" style="height: 300px; overflow-y: auto;">
                <!-- Aquí se mostrarán los mensajes -->
            </div>

            <!-- Input del chat -->
            <div class="input-group">
                <input type="text" id="chat-input" class="form-control" placeholder="Escribe tu mensaje aquí...">
                <div class="input-group-append">
                    <button id="send-button" class="btn btn-primary">Enviar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estilos opcionales para mensajes -->
<style>
    .user-message {
        text-align: right;
        margin-bottom: 10px;
        color: #007bff;
        font-weight: bold;
    }
    .bot-message {
        text-align: left;
        margin-bottom: 10px;
        color: #28a745;
        font-weight: bold;
    }
</style>

<!-- Script para manejar el chat con IA -->
<script>
    const roomName = "default_room";
    const chatSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/chat/' + roomName + '/'
    );

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const message = data.message;
        const chatMessages = document.getElementById('chat-messages');
        const botMessage = document.createElement('div');
        botMessage.className = 'bot-message';
        botMessage.textContent = 'IA: ' + message;
        chatMessages.appendChild(botMessage);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.getElementById('send-button').onclick = function(e) {
        const inputField = document.getElementById('chat-input');
        const input = inputField.value.trim();
        if (input === '') return;

        chatSocket.send(JSON.stringify({ 'message': input }));

        const chatMessages = document.getElementById('chat-messages');
        const userMessage = document.createElement('div');
        userMessage.className = 'user-message';
        userMessage.textContent = 'Tú: ' + input;
        chatMessages.appendChild(userMessage);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        inputField.value = '';
    };
</script>
{% endblock %}
