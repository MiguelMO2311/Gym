{% extends "base.html" %}
{% load static %}

{% block title %}
    Chat ‚Äì Sports App
{% endblock %}

{% block extra_head %}
    <meta name="description" content="Comunicaci√≥n directa entre entrenadores y atletas para mejorar el rendimiento y la motivaci√≥n.">
    <meta name="keywords" content="chat deportivo, entrenador, atleta, comunicaci√≥n, Sports App">
    <meta name="author" content="Sports App">
    <meta property="og:title" content="Chat Deportivo">
    <meta property="og:description" content="Espacio de comunicaci√≥n entre entrenadores y atletas.">

    {% comment %} <style>
    /* Fondo general claro y texto oscuro */
    body {
        background-color: #f0f2f5 !important;
        color: #212529 !important;
        font-family: 'Segoe UI', sans-serif;
    }

    /* Contenedores principales */
    .container-fluid, .saludo-usuario, .usuarios-asociados, #chat-section {
        background-color: #ffffff !important;
        color: #212529 !important;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0,0,0,0.05);
        margin-bottom: 2rem;
    }

    /* T√≠tulos y encabezados */
    h1, h4 {
        color: #212529 !important;
    }

    /* Lista de usuarios asociados */
    .list-group-item {
        background-color: #e3f0ff !important;
        color: #000000 !important;
        font-weight: 500;
        border: 1px solid #c0d4f4;
    }

    /* Selectores y formularios */
    .form-select, .form-control {
        background-color: #ffffff !important;
        color: #212529 !important;
        border: 1px solid #ced4da;
    }

    /* Botones */
    .btn {
        color: #ffffff !important;
    }

    .btn-primary {
        background-color: #007bff !important;
        border-color: #007bff !important;
    }

    /* Chat box */
    #chat-box {
        background-color: #ffffff !important;
        color: #212529 !important;
        max-height: 50vh;
        overflow-y: auto;
        border: 1px solid #dee2e6;
    }

    /* Select options */
    #group-select option {
        background-color: #ffffff !important;
        color: #212529 !important;
    }

    /* Alertas */
    .alert {
        background-color: #e9f7ff !important;
        color: #212529 !important;
        border: 1px solid #bde0fe;
    }
</style> {% endcomment %}

{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Saludo personalizado -->
    <div class="saludo-usuario text-center">
        <h1 class="display-2 fw-bold">Hola {{ user.username }}</h1>
        <p class="fs-4 fst-italic">‚ÄúCada mensaje puede acercarte a tu mejor versi√≥n. ¬°Expr√©sate y evoluciona!‚Äù</p>
    </div>

    <!-- Usuarios asociados -->
    <div class="usuarios-asociados text-center">
        <h4 class="mb-4">
            {% if user.user_type == "coach" %}
                Atletas Asociados
            {% elif user.user_type == "athlete" %}
                Entrenadores Asociados
            {% else %}
                Usuarios Asociados
            {% endif %}
        </h4>
        <ul class="list-group list-group-flush mx-auto" style="max-width: 600px;">
            {% if user.user_type == "coach" %}
                {% for athlete in athletes %}
                    <li class="list-group-item custom-visible text-center">{{ athlete }}</li>
                {% empty %}
                    <li class="list-group-item text-muted text-center">No hay atletas asociados actualmente.</li>
                {% endfor %}
            {% elif user.user_type == "athlete" %}
                {% for coach in coaches %}
                    <li class="list-group-item custom-visible text-center">{{ coach }}</li>
                {% empty %}
                    <li class="list-group-item text-muted text-center">No hay entrenadores asociados actualmente.</li>
                {% endfor %}
            {% else %}
                <li class="list-group-item text-muted text-center">No hay datos disponibles para tu rol.</li>
            {% endif %}
        </ul>
    </div>

    <!-- Chat grupal -->
    <div id="chat-section" class="mt-5">
        <h4 class="mb-3 text-center">üí¨ Chat IA y Grupal</h4>

        <!-- Mensaje de bienvenida al chat -->
        <div class="mb-4 mx-auto" style="max-width: 700px;">
            {% if user.user_type == "coach" %}
                <div class="alert alert-info text-dark text-center">
                    <strong>Bienvenido al chat grupal, Entrenador.</strong><br>
                    Comun√≠cate directamente con tus atletas, comparte indicaciones y mant√©n la motivaci√≥n del grupo.
                </div>
            {% elif user.user_type == "athlete" %}
                <div class="alert alert-info text-dark text-center">
                    <strong>Bienvenido al chat grupal, Atleta.</strong><br>
                    Interact√∫a con tus entrenadores, recibe orientaci√≥n personalizada y fortalece tu rendimiento.
                </div>
            {% else %}
                <div class="alert alert-secondary text-dark text-center">
                    <strong>Bienvenido al chat.</strong><br>
                    Accede a tus grupos y comun√≠cate seg√∫n tu rol en la plataforma.
                </div>
            {% endif %}
        </div>

        <!-- Selector de grupo -->
        <div class="mb-3 text-center">
            <label for="group-select" class="form-label">Selecciona grupo:</label>
            <select id="group-select" class="form-select text-dark mx-auto" style="max-width: 300px;">
                {% for g in groups %}
                    <option value="{{ g.name }}" {% if forloop.first %}selected{% endif %}>{{ g.name }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Caja de chat -->
        <div id="chat-box" class="border rounded p-3 bg-white text-dark mb-3 mx-auto" style="max-width: 900px;">
        </div>

        <!-- Formulario de env√≠o -->
        <form id="chat-form" class="mx-auto" style="max-width: 900px;">
            <div class="input-group">
                <input type="text" id="chat-input" class="form-control" placeholder="Escribe tu mensaje..." required>
                <button class="btn btn-primary" type="submit">Enviar</button>
            </div>
        </form>
    </div>
</div>

<script src="{% static 'chat/js/chat.js' %}"></script>
{% endblock %}
